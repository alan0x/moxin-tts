# mofa-tts Few-ShotéŸ³è‰²å…‹éš†å†³ç­–åˆ†æ

## æ‰§è¡Œæ‘˜è¦

**æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆ1 - ç»§ç»­ä½¿ç”¨dora-primespeech + æ‰©å±•è®­ç»ƒèƒ½åŠ›**

ç†ç”±ï¼šdora-primespeechå·²ç»å†…ç½®äº†å®Œæ•´çš„GPT-SoVITSè®­ç»ƒå·¥å…·é“¾ï¼Œæ— éœ€å¼•å…¥é¢å¤–çš„MoYoYo.ttsé¡¹ç›®ã€‚åªéœ€æ·»åŠ è®­ç»ƒæµç¨‹çš„å°è£…å’ŒUIé›†æˆå³å¯ã€‚

---

## å½“å‰é¡¹ç›®æ¶æ„åˆ†æ

### mofa-studioæŠ€æœ¯æ ˆ
- **å‰ç«¯**: Rust + Makepad (UIæ¡†æ¶)
- **åç«¯/æ•°æ®æµ**: Dora (æ•°æ®æµç¼–æ’)
- **PythonèŠ‚ç‚¹**: é€šè¿‡node-hubæä¾›ï¼Œä¸Rust UIé€šè¿‡mofa-dora-bridgeé€šä¿¡

### mofa-ttså½“å‰å®ç°
```
mofa-tts (Rust UI)
    â†“ mofa-dora-bridge
    â†“ Doraæ•°æ®æµ
    â†“
[dora-primespeech] â† TTSæ¨ç† (é›¶æ ·æœ¬å…‹éš†)
[dora-asr] â† ASRè¯†åˆ«
```

---

## å…³é”®å‘ç°

### 1. dora-primespeechçš„å†…éƒ¨ç»“æ„

```
dora-primespeech/
â”œâ”€â”€ dora_primespeech/
â”‚   â”œâ”€â”€ main.py                              # DoraèŠ‚ç‚¹å…¥å£
â”‚   â”œâ”€â”€ config.py                            # è¯­éŸ³é…ç½®
â”‚   â”œâ”€â”€ moyoyo_tts/                          # â­ å®Œæ•´çš„GPT-SoVITSå®ç°
â”‚   â”‚   â”œâ”€â”€ s1_train.py                      # â­ Stage 1è®­ç»ƒï¼ˆGPTæ¨¡å‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ s2_train.py                      # â­ Stage 2è®­ç»ƒï¼ˆSoVITSæ¨¡å‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ inference_webui.py               # æ¨ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”‚   â”œâ”€â”€ asr/                         # â­ ASRå·¥å…·ï¼ˆFunASR + Faster Whisperï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ funasr_asr.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ fasterwhisper_asr.py
â”‚   â”‚   â”‚   â”œâ”€â”€ slice_audio.py               # â­ éŸ³é¢‘åˆ‡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ cmd-denoise.py               # â­ é™å™ª
â”‚   â”‚   â”‚   â””â”€â”€ uvr5/                        # â­ äººå£°åˆ†ç¦»
â”‚   â”‚   â””â”€â”€ TTS_infer_pack/                  # æ¨ç†æµæ°´çº¿
â”‚   â””â”€â”€ moyoyo_tts_wrapper_streaming_fix.py  # æµå¼å°è£…
```

**ç»“è®º**: dora-primespeechå·²ç»åŒ…å«äº†few-shotè®­ç»ƒæ‰€éœ€çš„æ‰€æœ‰å·¥å…·ï¼

### 2. MoYoYo.ttsçš„ç»“æ„

```
MoYoYo.tts/
â”œâ”€â”€ api_server/              # FastAPIåç«¯
â”‚   â”œâ”€â”€ app/api/v1/
â”‚   â”‚   â”œâ”€â”€ tasks.py         # å¿«é€Ÿæ¨¡å¼API
â”‚   â”‚   â””â”€â”€ experiments.py   # é«˜çº§æ¨¡å¼API
â”œâ”€â”€ GPT_SoVITS/              # ä¸moyoyo_ttsç›¸åŒçš„æ ¸å¿ƒå¼•æ“
â”œâ”€â”€ training_pipeline/       # è®­ç»ƒæµæ°´çº¿ç®¡ç†å™¨
â”œâ”€â”€ tts-voice-app/          # Electronæ¡Œé¢åº”ç”¨
â””â”€â”€ webui.py                # Webç•Œé¢
```

**ç»“è®º**: MoYoYo.ttsæ˜¯ç‹¬ç«‹å¹³å°ï¼Œä½†å…¶æ ¸å¿ƒå¼•æ“ä¸dora-primespeechå†…çš„moyoyo_ttsç›¸åŒã€‚

### 3. ä¾èµ–å…³ç³»å›¾

```
MoYoYo.tts (ç‹¬ç«‹å¹³å°)
    â”‚
    â”œâ”€ FastAPIæœåŠ¡å™¨
    â”œâ”€ Electron UI
    â””â”€ GPT-SoVITSå¼•æ“ â†â”€â”
                        â”‚ (ç›¸åŒçš„æ ¸å¿ƒ)
dora-primespeech        â”‚
    â””â”€ moyoyo_tts â”€â”€â”€â”€â”€â”€â”˜
        â”œâ”€ è®­ç»ƒè„šæœ¬ (s1_train.py, s2_train.py)
        â””â”€ å·¥å…·é“¾ (ASR, åˆ‡ç‰‡, é™å™ª)
```

---

## æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1: ç»§ç»­ä½¿ç”¨dora-primespeech â­â­â­â­â­ (æ¨è)

#### å®ç°æ–¹å¼

**A. åˆ›å»ºè®­ç»ƒä¸“ç”¨DoraèŠ‚ç‚¹ï¼ˆæ¨èï¼‰**

```
æ–°å»º: node-hub/dora-voice-trainer/
â”œâ”€â”€ dora_voice_trainer/
â”‚   â”œâ”€â”€ main.py                    # DoraèŠ‚ç‚¹å…¥å£
â”‚   â”œâ”€â”€ training_orchestrator.py   # è®­ç»ƒæµç¨‹ç¼–æ’
â”‚   â””â”€â”€ config.py                  # è®­ç»ƒé…ç½®
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

èŠ‚ç‚¹æ¥å£è®¾è®¡ï¼š
```yaml
# è¾“å…¥
- control (string): è®­ç»ƒå‘½ä»¤
  - "start_training:voice_name"
  - "check_progress:task_id"
  - "cancel_training:task_id"

- audio_data (bytes): éŸ³é¢‘æ–‡ä»¶æ•°æ®
- audio_metadata (json):
  - file_name: string
  - duration: float
  - sample_rate: int

# è¾“å‡º
- status (string): è®­ç»ƒçŠ¶æ€
  - "queued", "preprocessing", "training_stage1",
    "training_stage2", "completed", "error"

- progress (json):
  - task_id: string
  - stage: string
  - percentage: float (0.0-1.0)
  - message: string

- model_ready (event): è®­ç»ƒå®Œæˆäº‹ä»¶
  - voice_name: string
  - model_path: string
```

è®­ç»ƒæµç¨‹ï¼š
```python
# åœ¨dora_voice_trainer/training_orchestrator.pyä¸­
class VoiceTrainingOrchestrator:
    def train_few_shot(self, audio_files, voice_name, config):
        """Few-shotè®­ç»ƒæµç¨‹"""

        # 1. éŸ³é¢‘é¢„å¤„ç†
        yield {"stage": "preprocessing", "progress": 0.1}
        processed_audio = self._slice_audio(audio_files)

        # 2. ASRè‡ªåŠ¨æ ‡æ³¨
        yield {"stage": "asr", "progress": 0.3}
        transcripts = self._run_asr(processed_audio)

        # 3. ç‰¹å¾æå–
        yield {"stage": "feature_extraction", "progress": 0.5}
        self._extract_features(processed_audio, transcripts)

        # 4. Stage 1è®­ç»ƒï¼ˆGPTæ¨¡å‹ï¼‰
        yield {"stage": "training_stage1", "progress": 0.7}
        self._train_stage1(config)

        # 5. Stage 2è®­ç»ƒï¼ˆSoVITSæ¨¡å‹ï¼‰
        yield {"stage": "training_stage2", "progress": 0.9}
        self._train_stage2(config)

        # 6. æ·»åŠ åˆ°dora-primespeeché…ç½®
        yield {"stage": "completed", "progress": 1.0}
        self._register_voice(voice_name)

    def _run_asr(self, audio_files):
        """è°ƒç”¨moyoyo_tts/tools/asr"""
        from dora_primespeech.moyoyo_tts.tools.asr import funasr_asr
        # ... å®ç°

    def _train_stage1(self, config):
        """è°ƒç”¨moyoyo_tts/s1_train.py"""
        from dora_primespeech.moyoyo_tts import s1_train
        # ... å®ç°
```

**B. æˆ–è€…ï¼šç›´æ¥åœ¨UIå±‚è°ƒç”¨è®­ç»ƒè„šæœ¬ï¼ˆæ›´ç®€å•ï¼‰**

```rust
// åœ¨mofa-ttsçš„Rustä»£ç ä¸­
impl MofaTtsApp {
    fn start_few_shot_training(&mut self, audio_files: Vec<PathBuf>, voice_name: String) {
        // 1. é€šè¿‡subprocessè°ƒç”¨Pythonè®­ç»ƒè„šæœ¬
        let output = Command::new("python")
            .arg("path/to/dora-primespeech/dora_primespeech/moyoyo_tts/s1_train.py")
            .arg("--input_dir").arg(input_dir)
            .arg("--output_dir").arg(output_dir)
            .spawn()
            .expect("Failed to start training");

        // 2. ç›‘æ§è®­ç»ƒè¿›åº¦ï¼ˆé€šè¿‡æ—¥å¿—æ–‡ä»¶æˆ–IPCï¼‰
        self.poll_training_progress();

        // 3. è®­ç»ƒå®Œæˆåé€šçŸ¥ç”¨æˆ·å¹¶é‡æ–°åŠ è½½è¯­éŸ³åˆ—è¡¨
    }
}
```

#### ä¼˜åŠ¿
âœ… **æ¶æ„ä¸€è‡´**: å®Œå…¨ç¬¦åˆç°æœ‰çš„DoraèŠ‚ç‚¹æ¶æ„
âœ… **é›¶é‡å¤**: ä¸å¼•å…¥é‡å¤çš„ä¾èµ–ï¼ˆé¿å…ä¸¤ä¸ªmoyoyo_ttså®ä¾‹ï¼‰
âœ… **ä»£ç å¤ç”¨**: dora-primespeechå·²åŒ…å«æ‰€æœ‰å¿…è¦å·¥å…·
âœ… **é›†æˆç®€å•**: ä¸ç°æœ‰çš„dora-primespeechæ¨ç†èŠ‚ç‚¹æ— ç¼é…åˆ
âœ… **ç»´æŠ¤æˆæœ¬ä½**: åªéœ€ç»´æŠ¤ä¸€å¥—GPT-SoVITSä»£ç 
âœ… **è½»é‡çº§**: ä¸éœ€è¦FastAPIæœåŠ¡å™¨ã€æ•°æ®åº“ç­‰é¢å¤–ç»„ä»¶

#### åŠ£åŠ¿
âš ï¸ **éœ€è¦è‡ªå·±å®ç°è®­ç»ƒUI**: æ²¡æœ‰ç°æˆçš„å›¾å½¢ç•Œé¢
âš ï¸ **éœ€è¦å®ç°è¿›åº¦ç›‘æ§**: éœ€è¦è‡ªå·±è®¾è®¡è®­ç»ƒè¿›åº¦åé¦ˆæœºåˆ¶
âš ï¸ **ç¼ºå°‘ä»»åŠ¡ç®¡ç†**: éœ€è¦å®ç°è®­ç»ƒä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚æœéœ€è¦ï¼‰

#### å·¥ä½œé‡ä¼°è®¡
- **æ–¹æ¡ˆAï¼ˆDoraèŠ‚ç‚¹ï¼‰**: 2-3å¤©
  - 1å¤©ï¼šè®¾è®¡èŠ‚ç‚¹æ¥å£å’Œè®­ç»ƒæµç¨‹ç¼–æ’
  - 1å¤©ï¼šé›†æˆç°æœ‰è®­ç»ƒè„šæœ¬
  - 0.5å¤©ï¼šRust UIé›†æˆ
  - 0.5å¤©ï¼šæµ‹è¯•å’Œè°ƒè¯•

- **æ–¹æ¡ˆBï¼ˆç›´æ¥è°ƒç”¨ï¼‰**: 1-2å¤©
  - 0.5å¤©ï¼šå°è£…è®­ç»ƒè„šæœ¬è°ƒç”¨
  - 0.5å¤©ï¼šå®ç°è¿›åº¦ç›‘æ§
  - 0.5å¤©ï¼šRust UIé›†æˆ
  - 0.5å¤©ï¼šæµ‹è¯•å’Œè°ƒè¯•

---

### æ–¹æ¡ˆ2: å°†MoYoYo.ttsåŒ…è£…æˆDoraèŠ‚ç‚¹ â­â­

#### å®ç°æ–¹å¼

```
æ–°å»º: node-hub/dora-moyoyo-wrapper/
â”œâ”€â”€ dora_moyoyo_wrapper/
â”‚   â”œâ”€â”€ main.py                # DoraèŠ‚ç‚¹å…¥å£
â”‚   â”œâ”€â”€ api_client.py          # MoYoYo.tts APIå®¢æˆ·ç«¯
â”‚   â””â”€â”€ config.py
â””â”€â”€ pyproject.toml
```

éœ€è¦ï¼š
1. å¯åŠ¨MoYoYo.ttsçš„APIæœåŠ¡å™¨ï¼ˆä½œä¸ºåå°æœåŠ¡ï¼‰
2. åˆ›å»ºDoraèŠ‚ç‚¹ä½œä¸ºAPIå®¢æˆ·ç«¯
3. å°†è®­ç»ƒè¯·æ±‚è½¬å‘åˆ°MoYoYo.tts API

```python
# dora_moyoyo_wrapper/main.py
class MoYoYoWrapperNode:
    def __init__(self):
        self.api_base = "http://localhost:8000"  # MoYoYo.tts API

    def on_input(self, dora_input):
        if dora_input["id"] == "start_training":
            # è°ƒç”¨MoYoYo.tts API
            response = requests.post(
                f"{self.api_base}/api/v1/tasks/quick",
                json=training_config
            )
            task_id = response.json()["task_id"]

            # è½®è¯¢è®­ç»ƒè¿›åº¦
            while True:
                progress = self._check_progress(task_id)
                self.send_output("progress", progress)
                if progress["status"] == "completed":
                    break
```

#### ä¼˜åŠ¿
âœ… **ç°æˆçš„UI**: å¯ä»¥ä½¿ç”¨MoYoYo.ttsçš„Web UIï¼ˆå¦‚æœéœ€è¦ï¼‰
âœ… **å®Œæ•´çš„åŠŸèƒ½**: ä»»åŠ¡ç®¡ç†ã€æ•°æ®åº“ã€ä»»åŠ¡é˜Ÿåˆ—éƒ½å·²å®ç°
âœ… **å¿«é€Ÿæ¨¡å¼**: å¯ä»¥ä½¿ç”¨ä¸€é”®å¼è®­ç»ƒæµç¨‹

#### åŠ£åŠ¿
âŒ **é‡å¤ä¾èµ–**: åŒæ—¶è¿è¡Œä¸¤å¥—moyoyo_ttsï¼ˆdora-primespeechå†…çš„ + MoYoYo.ttsï¼‰
âŒ **æ¶æ„å†—ä½™**: éœ€è¦å¯åŠ¨é¢å¤–çš„FastAPIæœåŠ¡å™¨
âŒ **å¤æ‚åº¦å¢åŠ **: å¤šäº†ä¸€å±‚APIé€šä¿¡
âŒ **èµ„æºæµªè´¹**: ä¸¤å¥—æ¨¡å‹åŠ è½½ï¼Œå†…å­˜å ç”¨ç¿»å€
âŒ **ç»´æŠ¤æˆæœ¬é«˜**: éœ€è¦ç»´æŠ¤ä¸¤ä¸ªé¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬åŒæ­¥
âŒ **ä¸ç¬¦åˆæ¶æ„**: DoraèŠ‚ç‚¹ä¸åº”è¯¥ä¾èµ–å¤–éƒ¨HTTPæœåŠ¡

#### å·¥ä½œé‡ä¼°è®¡
- 3-4å¤©
  - 1å¤©ï¼šé…ç½®MoYoYo.ttsæœåŠ¡å™¨
  - 1å¤©ï¼šå®ç°DoraåŒ…è£…èŠ‚ç‚¹
  - 1å¤©ï¼šRust UIé›†æˆ
  - 1å¤©ï¼šæµ‹è¯•å’Œè°ƒè¯•

---

### æ–¹æ¡ˆ3: æ··åˆæ–¹æ¡ˆ - å‚è€ƒMoYoYo.ttsè®¾è®¡ï¼Œåœ¨dora-primespeechä¸­å®ç° â­â­â­â­

#### å®ç°æ–¹å¼

å€Ÿé‰´MoYoYo.ttsçš„è®­ç»ƒæµæ°´çº¿è®¾è®¡ï¼Œä½†åœ¨dora-primespeechä¸­å®ç°ï¼š

```
æ‰©å±•: node-hub/dora-primespeech/
â”œâ”€â”€ dora_primespeech/
â”‚   â”œâ”€â”€ training/                          # â­ æ–°å¢è®­ç»ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ pipeline.py                    # å‚è€ƒMoYoYoçš„è®­ç»ƒæµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ stages/                        # è®­ç»ƒé˜¶æ®µ
â”‚   â”‚   â”‚   â”œâ”€â”€ preprocessing.py
â”‚   â”‚   â”‚   â”œâ”€â”€ feature_extraction.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stage1_training.py
â”‚   â”‚   â”‚   â””â”€â”€ stage2_training.py
â”‚   â”‚   â””â”€â”€ configs.py                     # è®­ç»ƒé…ç½®
â”‚   â””â”€â”€ moyoyo_tts/                        # å·²æœ‰çš„æ ¸å¿ƒå¼•æ“
```

å¤ç”¨MoYoYo.ttsçš„ä¼˜ç§€è®¾è®¡ï¼š
- è®­ç»ƒæµæ°´çº¿æ¶æ„
- è¿›åº¦å›è°ƒæœºåˆ¶
- é…ç½®ç®¡ç†æ–¹å¼

ä½†å®ç°åœ¨dora-primespeechä¸­ï¼Œé¿å…é‡å¤ä¾èµ–ã€‚

#### ä¼˜åŠ¿
âœ… **æœ€ä½³å®è·µ**: å¤ç”¨MoYoYo.ttsçš„æˆç†Ÿè®¾è®¡
âœ… **æ¶æ„ä¸€è‡´**: ä¿æŒDoraèŠ‚ç‚¹æ¶æ„
âœ… **æ— é‡å¤**: ä¸å¼•å…¥é‡å¤ä¾èµ–
âœ… **çµæ´»æ€§é«˜**: å¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶æµç¨‹

#### åŠ£åŠ¿
âš ï¸ **å¼€å‘é‡ä¸­ç­‰**: éœ€è¦å‚è€ƒå’Œç§»æ¤ä»£ç 
âš ï¸ **éœ€è¦ç†è§£ä¸¤ä¸ªé¡¹ç›®**: éœ€è¦æ·±å…¥äº†è§£MoYoYo.ttsçš„è®¾è®¡

#### å·¥ä½œé‡ä¼°è®¡
- 3-4å¤©
  - 1å¤©ï¼šç ”ç©¶MoYoYo.ttsçš„è®­ç»ƒæµæ°´çº¿è®¾è®¡
  - 1.5å¤©ï¼šåœ¨dora-primespeechä¸­å®ç°è®­ç»ƒæ¨¡å—
  - 0.5å¤©ï¼šRust UIé›†æˆ
  - 1å¤©ï¼šæµ‹è¯•å’Œè°ƒè¯•

---

## å†³ç­–çŸ©é˜µ

| ç»´åº¦ | æ–¹æ¡ˆ1A (Doraè®­ç»ƒèŠ‚ç‚¹) | æ–¹æ¡ˆ1B (ç›´æ¥è°ƒç”¨) | æ–¹æ¡ˆ2 (åŒ…è£…MoYoYo) | æ–¹æ¡ˆ3 (æ··åˆ) |
|------|---------------------|------------------|-------------------|--------------|
| **æ¶æ„ä¸€è‡´æ€§** | â­â­â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **ä»£ç å¤ç”¨** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­ |
| **å¼€å‘é€Ÿåº¦** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­ |
| **èµ„æºå ç”¨** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **åŠŸèƒ½å®Œæ•´æ€§** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **æ€»åˆ†** | 32/35 | 31/35 | 19/35 | 31/35 |

---

## æœ€ç»ˆæ¨è

### ğŸ† æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆ1Bï¼ˆç›´æ¥è°ƒç”¨è®­ç»ƒè„šæœ¬ï¼‰

**é€‚ç”¨åœºæ™¯**: å¿«é€Ÿå®ç°ã€åˆæœŸç‰ˆæœ¬ã€å›¢é˜Ÿè§„æ¨¡å°

**ç†ç”±**:
1. **æœ€å¿«å®ç°**: 1-2å¤©å³å¯å®Œæˆ
2. **æ¶æ„ç®€å•**: ä¸éœ€è¦å¤æ‚çš„èŠ‚ç‚¹é€šä¿¡
3. **ä»£ç å¤ç”¨**: 100%å¤ç”¨dora-primespeechç°æœ‰å·¥å…·
4. **é›¶é‡å¤**: ä¸å¼•å…¥ä»»ä½•å†—ä½™ä¾èµ–
5. **æ˜“äºè°ƒè¯•**: è®­ç»ƒè„šæœ¬å¯ä»¥ç‹¬ç«‹æµ‹è¯•

**å®æ–½è·¯å¾„**:
```
ç¬¬1æ­¥ï¼šè®¾è®¡UIæµç¨‹ï¼ˆ0.5å¤©ï¼‰
  â””â”€ éŸ³é¢‘ä¸Šä¼ /å½•åˆ¶ç•Œé¢
  â””â”€ éŸ³è‰²å‘½åç•Œé¢
  â””â”€ è®­ç»ƒè¿›åº¦æ˜¾ç¤º

ç¬¬2æ­¥ï¼šå°è£…è®­ç»ƒè„šæœ¬ï¼ˆ0.5å¤©ï¼‰
  â””â”€ Rust subprocessè°ƒç”¨Python
  â””â”€ å‚æ•°ä¼ é€’å’Œé…ç½®ç”Ÿæˆ
  â””â”€ æ—¥å¿—æ–‡ä»¶è§£æ

ç¬¬3æ­¥ï¼šé›†æˆåˆ°mofa-ttsï¼ˆ0.5å¤©ï¼‰
  â””â”€ æ·»åŠ "Few-Shot Clone"æŒ‰é’®
  â””â”€ è®­ç»ƒå®Œæˆååˆ·æ–°è¯­éŸ³åˆ—è¡¨
  â””â”€ é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

ç¬¬4æ­¥ï¼šæµ‹è¯•ï¼ˆ0.5å¤©ï¼‰
  â””â”€ ç«¯åˆ°ç«¯æµ‹è¯•
  â””â”€ è¾¹ç•Œæƒ…å†µå¤„ç†
```

### ğŸ¥ˆ å¤‡é€‰æ–¹æ¡ˆï¼šæ–¹æ¡ˆ1Aï¼ˆDoraè®­ç»ƒèŠ‚ç‚¹ï¼‰

**é€‚ç”¨åœºæ™¯**: éœ€è¦æ›´å¼ºçš„æµç¨‹æ§åˆ¶ã€éœ€è¦åˆ†å¸ƒå¼è®­ç»ƒã€å›¢é˜Ÿè§„æ¨¡è¾ƒå¤§

**ä½•æ—¶å‡çº§**:
- å½“éœ€è¦æ”¯æŒè®­ç»ƒé˜Ÿåˆ—ç®¡ç†æ—¶
- å½“éœ€è¦åœ¨å¤šå°æœºå™¨ä¸Šè®­ç»ƒæ—¶
- å½“éœ€è¦æ›´ç»†ç²’åº¦çš„è¿›åº¦åé¦ˆæ—¶
- å½“ç”¨æˆ·æ•°é‡å¢é•¿éœ€è¦æ›´robustçš„æ¶æ„æ—¶

**ä»1Båˆ°1Açš„å‡çº§è·¯å¾„**:
1. å°†è®­ç»ƒè„šæœ¬è°ƒç”¨é€»è¾‘æå–ä¸ºç‹¬ç«‹æ¨¡å—
2. åˆ›å»ºdora-voice-trainerèŠ‚ç‚¹
3. å°†è®­ç»ƒé€»è¾‘è¿ç§»åˆ°èŠ‚ç‚¹ä¸­
4. æ›´æ–°Rust UIä»¥ä½¿ç”¨Doraé€šä¿¡

---

## ä¸æ¨èæ–¹æ¡ˆ2çš„åŸå› 

### ä¸ºä»€ä¹ˆä¸ç”¨MoYoYo.ttsï¼Ÿ

**é—®é¢˜1: é‡å¤ä¾èµ–**
```
å½“å‰çŠ¶æ€:
mofa-studio
  â””â”€ dora-primespeech
      â””â”€ moyoyo_tts (åŒ…å«å®Œæ•´è®­ç»ƒå·¥å…·)

å¦‚æœä½¿ç”¨æ–¹æ¡ˆ2:
mofa-studio
  â”œâ”€ dora-primespeech
  â”‚   â””â”€ moyoyo_tts (å®ä¾‹1)
  â””â”€ dora-moyoyo-wrapper
      â””â”€ MoYoYo.tts
          â””â”€ GPT_SoVITS (å®ä¾‹2ï¼Œä¸moyoyo_ttsç›¸åŒ)

ç»“æœï¼šä¸¤ä¸ªç›¸åŒçš„æ¨¡å‹å¼•æ“ï¼Œå†…å­˜å ç”¨ç¿»å€ï¼
```

**é—®é¢˜2: æ¶æ„ä¸åŒ¹é…**
```
Doraçš„è®¾è®¡ç†å¿µ:
  èŠ‚ç‚¹ä¹‹é—´é€šè¿‡æ•°æ®æµé€šä¿¡ï¼Œä¸åº”ä¾èµ–å¤–éƒ¨æœåŠ¡

æ–¹æ¡ˆ2çš„æ¶æ„:
  DoraèŠ‚ç‚¹ â†’ HTTPè¯·æ±‚ â†’ FastAPIæœåŠ¡å™¨ â†’ è®­ç»ƒ

è¿èƒŒäº†Doraçš„è®¾è®¡ç†å¿µï¼Œå¼•å…¥äº†ä¸å¿…è¦çš„ç½‘ç»œå±‚ã€‚
```

**é—®é¢˜3: èµ„æºæµªè´¹**

| èµ„æºç±»å‹ | æ–¹æ¡ˆ1 | æ–¹æ¡ˆ2 | å·®å¼‚ |
|---------|-------|-------|------|
| Pythonè¿›ç¨‹ | 1ä¸ª | 2ä¸ªï¼ˆDora + FastAPIï¼‰ | +1 |
| æ¨¡å‹åŠ è½½ | 1æ¬¡ | 2æ¬¡ | +100% |
| å†…å­˜å ç”¨ | ~4GB | ~8GB | +100% |
| å¯åŠ¨æ—¶é—´ | ~5s | ~15s | +200% |

**é—®é¢˜4: ç»´æŠ¤å¤æ‚åº¦**
- éœ€è¦åŒæ­¥ä¸¤ä¸ªé¡¹ç›®çš„ä¾èµ–ç‰ˆæœ¬
- éœ€è¦ç¡®ä¿dora-primespeechå’ŒMoYoYo.ttsçš„æ¨¡å‹å…¼å®¹æ€§
- APIæ¥å£å˜æ›´éœ€è¦åŒæ—¶æ›´æ–°åŒ…è£…å±‚
- è°ƒè¯•å›°éš¾ï¼ˆéœ€è¦è·Ÿè¸ªè·¨è¿›ç¨‹é€šä¿¡ï¼‰

---

## å®æ–½å»ºè®®

### Phase 1: å¿«é€ŸéªŒè¯ï¼ˆæ–¹æ¡ˆ1Bï¼‰

**Week 1: MVPå®ç°**
- [ ] Day 1-2: è®¾è®¡è®­ç»ƒUIæµç¨‹
  - éŸ³é¢‘ä¸Šä¼ ç»„ä»¶
  - éŸ³è‰²å‘½åè¡¨å•
  - è®­ç»ƒè¿›åº¦æ¡

- [ ] Day 3-4: å°è£…è®­ç»ƒè„šæœ¬
  ```rust
  // training_manager.rs
  pub struct FewShotTrainer {
      workspace: PathBuf,
      moyoyo_path: PathBuf,
  }

  impl FewShotTrainer {
      pub async fn train(&self, audio_files: Vec<PathBuf>, voice_name: String)
          -> Result<TrainingProgress> {
          // 1. å‡†å¤‡è®­ç»ƒæ•°æ®
          let data_dir = self.prepare_training_data(audio_files)?;

          // 2. è¿è¡ŒASR
          self.run_asr(&data_dir).await?;

          // 3. è¿è¡Œè®­ç»ƒ
          let progress_rx = self.spawn_training_process(&data_dir, &voice_name)?;

          // 4. è¿”å›è¿›åº¦é€šé“
          Ok(progress_rx)
      }
  }
  ```

- [ ] Day 5: é›†æˆæµ‹è¯•
  - ç«¯åˆ°ç«¯è®­ç»ƒæµç¨‹æµ‹è¯•
  - è®­ç»ƒåæ¨ç†éªŒè¯
  - é”™è¯¯å¤„ç†æµ‹è¯•

**Week 2: ä¼˜åŒ–å’Œå®Œå–„**
- [ ] æ·»åŠ è®­ç»ƒå‚æ•°é…ç½®ï¼ˆè®­ç»ƒè½®æ•°ã€å­¦ä¹ ç‡ç­‰ï¼‰
- [ ] å®ç°è®­ç»ƒä¸­æ–­å’Œæ¢å¤
- [ ] æ·»åŠ è®­ç»ƒè´¨é‡è¯„ä¼°
- [ ] æ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—

### Phase 2: æ¶æ„å‡çº§ï¼ˆå¯é€‰ï¼Œæ–¹æ¡ˆ1Aï¼‰

**ä»…å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶æ‰å‡çº§ï¼š**
1. ç”¨æˆ·åé¦ˆéœ€è¦è®­ç»ƒé˜Ÿåˆ—ç®¡ç†
2. éœ€è¦æ”¯æŒè¿œç¨‹è®­ç»ƒï¼ˆäº‘ç«¯è®­ç»ƒï¼‰
3. éœ€è¦æ›´ç»†ç²’åº¦çš„è®­ç»ƒæ§åˆ¶
4. å›¢é˜Ÿå†³å®šé•¿æœŸç»´æŠ¤å’Œæ‰©å±•è®­ç»ƒåŠŸèƒ½

---

## MoYoYo.ttsçš„æ­£ç¡®ä½¿ç”¨æ–¹å¼

è™½ç„¶ä¸å»ºè®®å°†MoYoYo.ttsåŒ…è£…æˆDoraèŠ‚ç‚¹ï¼Œä½†å®ƒä»ç„¶å¾ˆæœ‰ä»·å€¼ï¼š

### ğŸ” å‚è€ƒå­¦ä¹ 
- ç ”ç©¶å…¶è®­ç»ƒæµæ°´çº¿è®¾è®¡ï¼ˆ`training_pipeline/`ï¼‰
- å­¦ä¹ å…¶è¿›åº¦åé¦ˆæœºåˆ¶
- å‚è€ƒå…¶é…ç½®ç®¡ç†æ–¹å¼
- äº†è§£å…¶é”™è¯¯å¤„ç†ç­–ç•¥

### ğŸ§ª ç‹¬ç«‹æµ‹è¯•
- åœ¨å¼€å‘æœºä¸Šè¿è¡ŒMoYoYo.ttsè¿›è¡Œè®­ç»ƒå®éªŒ
- æµ‹è¯•ä¸åŒçš„è®­ç»ƒå‚æ•°ç»„åˆ
- éªŒè¯è®­ç»ƒè´¨é‡
- ç”Ÿæˆæµ‹è¯•ç”¨çš„è¯­éŸ³æ¨¡å‹

### ğŸ“š æ–‡æ¡£å‚è€ƒ
- å‚è€ƒå…¶ç”¨æˆ·æŒ‡å—ç†è§£è®­ç»ƒæµç¨‹
- å­¦ä¹ å…¶æœ€ä½³å®è·µ
- äº†è§£å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### ğŸ”„ æ•°æ®äº’é€š
- åœ¨MoYoYo.ttsä¸­è®­ç»ƒçš„æ¨¡å‹å¯ä»¥å¯¼å…¥åˆ°dora-primespeech
- ä½¿ç”¨MoYoYo.ttsä½œä¸ºé«˜çº§ç”¨æˆ·çš„è®­ç»ƒå·¥å…·
- é€šè¿‡æ–‡ä»¶ç³»ç»Ÿå…±äº«è®­ç»ƒå¥½çš„æ¨¡å‹

---

## å…³é”®æ–‡ä»¶æ¸…å•

### dora-primespeechä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å·¥å…·

```
è®­ç»ƒç›¸å…³ï¼š
âœ… dora_primespeech/moyoyo_tts/s1_train.py
âœ… dora_primespeech/moyoyo_tts/s2_train.py

é¢„å¤„ç†å·¥å…·ï¼š
âœ… dora_primespeech/moyoyo_tts/tools/slice_audio.py
âœ… dora_primespeech/moyoyo_tts/tools/cmd-denoise.py
âœ… dora_primespeech/moyoyo_tts/tools/uvr5/ (äººå£°åˆ†ç¦»)

ASRå·¥å…·ï¼š
âœ… dora_primespeech/moyoyo_tts/tools/asr/funasr_asr.py (ä¸­æ–‡)
âœ… dora_primespeech/moyoyo_tts/tools/asr/fasterwhisper_asr.py (è‹±æ–‡ç­‰)

é…ç½®ç¤ºä¾‹ï¼š
âœ… dora_primespeech/moyoyo_tts/configs/ (è®­ç»ƒé…ç½®æ¨¡æ¿)

æ¨ç†æ¥å£ï¼š
âœ… dora_primespeech/moyoyo_tts/inference_webui.py
âœ… dora_primespeech/moyoyo_tts/inference_webui_fast.py
```

### éœ€è¦åˆ›å»ºçš„æ–°æ–‡ä»¶ï¼ˆæ–¹æ¡ˆ1Bï¼‰

```rust
// mofa-studio/apps/mofa-tts/src/training/
mod.rs                          // è®­ç»ƒæ¨¡å—å…¥å£
training_manager.rs             // è®­ç»ƒæµç¨‹ç®¡ç†
training_config.rs              // è®­ç»ƒé…ç½®
progress_monitor.rs             // è¿›åº¦ç›‘æ§
voice_registry.rs               // è¯­éŸ³æ³¨å†Œå’Œç®¡ç†
```

```python
# mofa-studio/node-hub/dora-primespeech/scripts/ (å¯é€‰çš„è¾…åŠ©è„šæœ¬)
train_few_shot.py               # å°è£…å¥½çš„è®­ç»ƒè„šæœ¬
prepare_dataset.py              # æ•°æ®é›†å‡†å¤‡è„šæœ¬
validate_training.py            # è®­ç»ƒç»“æœéªŒè¯
```

---

## é£é™©è¯„ä¼°

### æ–¹æ¡ˆ1é£é™©ï¼ˆä½ï¼‰

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| è®­ç»ƒè„šæœ¬è°ƒç”¨å¤±è´¥ | ä¸­ | ä¸­ | å……åˆ†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½• |
| è¿›åº¦ç›‘æ§ä¸å‡†ç¡® | ä¸­ | ä½ | è§£æè®­ç»ƒæ—¥å¿—æ–‡ä»¶ |
| è®­ç»ƒä¸­æ–­å¤„ç† | ä½ | ä¸­ | å®ç°è®­ç»ƒçŠ¶æ€ä¿å­˜å’Œæ¢å¤ |
| æ¨¡å‹å…¼å®¹æ€§é—®é¢˜ | ä½ | é«˜ | ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„GPT-SoVITS |

### æ–¹æ¡ˆ2é£é™©ï¼ˆé«˜ï¼‰

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| ä¾èµ–ç‰ˆæœ¬å†²çª | é«˜ | é«˜ | ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦» |
| APIæœåŠ¡å™¨å´©æºƒ | ä¸­ | é«˜ | å®ç°å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯ |
| å†…å­˜å ç”¨è¿‡é«˜ | é«˜ | ä¸­ | ä¼˜åŒ–æ¨¡å‹åŠ è½½ç­–ç•¥ |
| ç»´æŠ¤å¤æ‚åº¦å¢åŠ  | é«˜ | ä¸­ | éœ€è¦æ›´å¤šå¼€å‘èµ„æº |

---

## æ€»ç»“

### å†³ç­–å»ºè®®

```
æ¨èå®æ–½è·¯å¾„:

ç°åœ¨ï¼ˆMVPé˜¶æ®µï¼‰:
  â””â”€ æ–¹æ¡ˆ1B: ç›´æ¥è°ƒç”¨dora-primespeechä¸­çš„è®­ç»ƒè„šæœ¬
      â”œâ”€ å¼€å‘æ—¶é—´: 1-2å¤©
      â”œâ”€ é£é™©: ä½
      â””â”€ æŠ•èµ„å›æŠ¥: é«˜

æœªæ¥ï¼ˆæ‰©å±•é˜¶æ®µï¼Œå¯é€‰ï¼‰:
  â””â”€ æ–¹æ¡ˆ1A: å‡çº§ä¸ºDoraè®­ç»ƒèŠ‚ç‚¹
      â”œâ”€ è§¦å‘æ¡ä»¶: éœ€è¦æ›´robustçš„æ¶æ„
      â”œâ”€ å‡çº§æ—¶é—´: 2-3å¤©
      â””â”€ è¿ç§»æˆæœ¬: ä½ï¼ˆä»£ç å¯å¤ç”¨ï¼‰

ä¸æ¨è:
  â””â”€ æ–¹æ¡ˆ2: åŒ…è£…MoYoYo.tts
      â””â”€ åŸå› : é‡å¤ä¾èµ–ã€æ¶æ„ä¸åŒ¹é…ã€èµ„æºæµªè´¹
```

### MoYoYo.ttsçš„æ­£ç¡®å®šä½

MoYoYo.ttsä¸æ˜¯ç”¨æ¥é›†æˆçš„ï¼Œè€Œæ˜¯ç”¨æ¥ï¼š
1. **å­¦ä¹ å‚è€ƒ**: ç ”ç©¶å…¶ä¼˜ç§€çš„è®¾è®¡
2. **ç‹¬ç«‹æµ‹è¯•**: åœ¨å¼€å‘æœºä¸Šè¿›è¡Œè®­ç»ƒå®éªŒ
3. **é«˜çº§å·¥å…·**: ä½œä¸ºå¯é€‰çš„é«˜çº§è®­ç»ƒå·¥å…·
4. **æ–‡æ¡£èµ„æº**: å‚è€ƒå…¶ç”¨æˆ·æŒ‡å—å’Œæœ€ä½³å®è·µ

### å…³é”®è¦ç‚¹

1. âœ… **dora-primespeechå·²ç»åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„è®­ç»ƒå·¥å…·**
2. âœ… **ä¸éœ€è¦å¼•å…¥MoYoYo.ttsä½œä¸ºä¾èµ–**
3. âœ… **ä¿æŒæ¶æ„ç®€å•å’Œä¸€è‡´**
4. âœ… **å…ˆå¿«é€Ÿå®ç°MVPï¼Œåç»­æŒ‰éœ€å‡çº§**
5. âŒ **é¿å…é‡å¤ä¾èµ–å’Œæ¶æ„å†—ä½™**

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-02
**åˆ†æè€…**: Claude Sonnet 4.5
**é¡¹ç›®**: mofa-studio/mofa-tts
**å†³ç­–ç±»å‹**: æŠ€æœ¯æ¶æ„é€‰å‹
